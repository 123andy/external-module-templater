#!/usr/bin/env bash

# This script assumes you have installed the offical github cli tool `gh`
# For instructions, please see: https://cli.github.com/manual/installation

echo "This script will initialize this folder as a new git repository, check in all of the"
echo "files, create a new repository as github.com/{{ gitRepo }}/{{ gitOrg }}, and do the"
echo "initial push of files"
echo
read -p "Are you sure you would like to continue (y/n)? " -n 1 -r
if [[ $REPLY =~ ^[Yy]$ ]]
then
    echo
    set -x
    git init .
    git add .
    git commit -m 'initial template'
    gh repo create {{ gitOrg }}/{{ gitRepo }} --public --source=. --push
{% if gitTeam %}
    # grant team admin access to repo
    gh api --method PUT -H "Accept: application/vnd.github+json" /orgs/{{ gitOrg }}/teams/{{ gitTeam }}/repos/{{ gitOrg }}/{{ gitRepo }} -f permission='admin'
    echo "Team {{ gitOrg }}/{{ gitTeam }} has been granted admin permission to {{ getRepo }}"
{% endif %}
    echo
    echo "You can view the repo and review settings at https://github.com/{{ gitOrg }}/{{ gitRepo }}"
    echo
fi

read -p "Would you like to open the repo in your browser (y/n)? " -n 1 -r
if [[ $REPLY =~ ^[Yy]$ ]]
then
    echo
    python3 -m webbrowser https://github.com/{{ gitOrg }}/{{ gitRepo }}
fi

